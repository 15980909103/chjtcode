(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/houses/index"],{"0775":function(t,e,i){"use strict";(function(t){i("e878");n(i("66fd"));var e=n(i("6765"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},"0bed":function(t,e,i){"use strict";var n=i("17d9"),o=i.n(n);o.a},"17d9":function(t,e,i){},"61aa":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(i("9ed8"));function o(t){return t&&t.__esModule?t:{default:t}}function s(t){return c(t)||u(t)||r(t)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t,e){if(t){if("string"===typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}function u(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function c(t){if(Array.isArray(t))return h(t)}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function l(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?l(Object(i),!0).forEach((function(e){d(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):l(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var g=function(){i.e("components/houses/surface").then(function(){return resolve(i("b762"))}.bind(null,i)).catch(i.oe)},f=function(){i.e("components/common/template_information").then(function(){return resolve(i("9940"))}.bind(null,i)).catch(i.oe)},m=function(){i.e("components/houses/comment").then(function(){return resolve(i("20dd"))}.bind(null,i)).catch(i.oe)},v=function(){i.e("components/common/template_newHouse").then(function(){return resolve(i("6f0c"))}.bind(null,i)).catch(i.oe)},_=function(){i.e("components/uni-nav-bar/uni-nav-bar").then(function(){return resolve(i("e898"))}.bind(null,i)).catch(i.oe)},b=function(){Promise.all([i.e("common/vendor"),i.e("components/map/nearby")]).then(function(){return resolve(i("e5a1"))}.bind(null,i)).catch(i.oe)},y=null,w={data:function(){return{safeBottom:0,pageShow:!1,active_id:0,contactPhone:"#",visible:!0,surfaceList:{},careState:0,haveApply:!1,is_sign:!1,houseId:-1,houseType:1,city_code:350200,bannerActive:1,bannerList:[{name:"图片",list:[]}],limit_remark_num:3,arrow_show:0,infoList:{},markElHeight:0,markHeight:"60rpx",applyList:{id:-1,title:"",tip:"",day:"",people:"",desc:"",share_title:"",share_desc:"",share_img:""},showApply:!1,applyContent:"",haveCharts:!0,stickyHeight:0,active:0,scrollTop:0,inScroll:!1,navList:[{id:1,name:"户型",title:"户型介绍",list:[]},{id:2,name:"价格走势",title:"价格走势",list:[]},{id:3,name:"周边",title:"位置周边",list:{}},{id:4,name:"资讯",title:"实时资讯",list:[]},{id:5,name:"测评",title:"实时测评",list:[]},{id:7,name:"点评",title:"用户点评",list:[]},{id:8,name:"沙盘图",title:"沙盘图",list:{img:"../../static/logo.png",num:0}}],changeState:!0,saleShow:{},saleClass:{},contactShow:!1,contactList:[],likeList:[],overflowY:"scroll",option:""}},components:{surface:g,uniNavBar:_,news:f,comment:m,nearbyMap:b,commonTemplate:v},onLoad:function(e){this.safeBottom=t.getSystemInfoSync().safeAreaInsets.bottom,this.houseId=e.id,this.option=e,this.initSurface(),this.init()},onShow:function(){console.log("houseId",this.houseId),this.getTalk()},methods:{initSurface:function(t){0!=this.option.cover||(this.visible=!1)},init:function(){var t=this,e=this.option.active_id;e&&(this.active_id=e);var i=this.option.type;i||(this.houseType=i),this.$nextTick((function(){t.bannerActive=0})),this.getInfo(),this.getSwiperList(),this.getHouseList(),this.getNews(),this.getEval(),this.getEstatesLike()},getInfo:function(){var t=this,e=this.houseId,i=this.houseType,n={};n.id=e,1==i&&(n["from"]="search"),this.$http.post("estates/getInfo",n).then((function(e){if(0!=e.code){var i=e.data;console.log(e,777),i.open_time||(i.open_time="暂无数据"),t.$u.mpShare=t.$api.shareInfo(e);var n={},o={},s={},a={};if(n.tip=[],n.bg=i.detail_cover,n.logo=i.logo,n.title=i.name,n.price=i.price,n.site=i.address,n.time=i.open_time,n.phone=i.sales_telephone,t.careState=i.is_attention,i.sign_up&&i.sign_up.id&&(o.id=i.sign_up.id,o.title=i.sign_up.name,o.tip=i.sign_up.subname,o.day=i.sign_up.left_day,o.desc=i.sign_up.desc,o.people=i.sign_up.join_num,o.share_title=i.sign_up.share_title,o.share_desc=i.sign_up.share_desc,o.share_img=t.$api.imgDirtoUrl(i.sign_up.share_img),t.applyList=o,t.haveApply=!0,t.is_sign=!!i.is_sign),s.name=i.name,s.price=i.price,s.buyTime=i.open_time,s.houseType=i.house_type,s.area=i.built_area,s.site=i.address,t.navList.map((function(e,n){if(3==e.id){var o={lng:i.lng,lat:i.lat,title:i.name,site:i.address};t.$set(t.navList[n],"list",o)}else if(8==e.id){var s={img:i.sand_table&&i.sand_table[0]?i.sand_table[0]:"",num:i.building_num?i.building_num:0};t.$set(t.navList[n],"list",s)}})),i.discount&&i.discount.length>0){var r={id:0,name:"优惠",title:"优惠信息",sale:i.discount};t.navList.unshift(r)}for(var u in i.sale_status&&(a["estatesnew_sale_status"]=i.sale_status),i.house_purpose&&i.house_purpose.length>0&&(a["house_purpose"]=i.house_purpose),i.house_purpose&&(s.use=[],s.use=s.use.concat(t.$api.getTagsText({house_purpose:i.house_purpose}))),i.tags&&i.tags.length>0&&(a["feature_tag"]=i.tags),n.tip=n.tip.concat(t.$api.getTagsText(a)),s.remark=[],i.price_str&&(s.priceStr=i.price_str),i.common_tags&&Object.keys(i.common_tags).length>0&&(s.remark=s.remark.concat(t.$api.getTagsText(i.common_tags))),s.remark.length>t.limit_remark_num&&(t.arrow_show=1),t.surfaceList=n,t.infoList=s,i.agent){var c=i.agent[u];t.contactList.push({id:c.id,name:c.name,head:c.head_img?t.$api.imgDirtoUrl(c.head_img):t.$api.imgDirtoUrl("/logo.png",1),phone:c.phone})}t.pageShow=!0,t.getChartsList();var h=0;s.remark.map((function(t){h+=25*t.length+24+20})),h>650&&(t.markElHeight=60*Math.ceil(h/650)),t.getBarHeight()}else t.pageShow=!0}))},surfaceHide:function(t){if("video"==t);else if("img"==t)return void this.bannerMore();this.visible=!1},getBarHeight:function(){var t=this;this.$nextTick((function(){t.$u.getRect(".top-bar").then((function(e){t.stickyHeight=e.height}))}))},getSwiperList:function(){var t=this,e=this,i=this.houseId,n={estate_id:i};this.$http.post("estates/getBuildingPhotosList",n).then((function(i){var n=i.data,o=[];for(var s in n)9!=s&&n[s].map((function(t){o.push(e.$api.imgDirtoUrl(t.cover))}));t.bannerList.map((function(e,i){"图片"==e.name&&t.$set(t.bannerList[i],"list",o)}))}))},bannerMore:function(){var t={};t.id=this.houseId,this.option.active_id&&(t.active_id=this.option.active_id),console.log(9999),this.goPage("houses/banner_more",t)},goshare:function(){this.goPage("houses/share",{id:this.houseId})},bannerChange:function(t){this.bannerActive!=t&&(this.bannerActive=t)},goApply:function(){var t=this.option.active_id,e={id:this.houseId};t&&(e.active_id=t),this.goPage("houses/activty",e)},applyShow:function(){if(1!=this.is_sign){var t="";this.alertLogin(),t=getApp().globalData.userInfo.phone,this.applyContent="报名活动后将有专人联系您 手机号码".concat(t),this.showApply=!0}else this.$toast("您已报名成功")},sureApply:function(){var t=this,e={mobile:getApp().globalData.userInfo.phone,sign_id:this.applyList.id,type:1},i=this.option.active_id;i&&(e.active_id=i),this.$http.post("signUp/add",e).then((function(e){if(0!=e.code){e.data;t.$toast("报名成功"),t.is_sign=!0}else t.$toast(e.msg)}))},loanCalc:function(){this.goPage("houses/loan")},changeArrowShow:function(){this.markElHeight<80||(this.markHeight="60rpx"==this.markHeight?this.markElHeight+"rpx":"60rpx")},goMap:function(){var t={id:this.houseId,name:this.infoList.name};this.goPage("map/round",t)},moreInfo:function(){var t={};t.id=this.houseId,this.option.active_id&&(t.active_id=this.option.active_id),this.goPage("houses/info",t)},change:function(t,e){this.active!=t&&(this.active=t,1==e&&(this.$refs.nav.scrollToAnchor(t,1),this.changeState=!1))},navScroll:function(t){this.active!=t&&this.changeState&&this.change(t)},lookMore:function(t){var e={};switch(e.id=this.houseId,this.option.active_id&&(e.active_id=this.option.active_id),t){case 1:this.goPage("houses/house_type",e);break;case 4:case 5:this.goPage("houses/hot_news",p(p({},e),{typeId:t}));break;case 7:this.goPage("houses/comment",e);break;case 8:this.goPage("houses/sand",e);break}},showSale:function(t){var e=this;t=String(t),-1!=Object.keys(this.saleShow).indexOf(t)?this.saleShow[t]?(this.$set(this.saleClass,t,"van-slide-down-leave-active"),setTimeout((function(){e.saleShow[t]=!e.saleShow[t]}),300)):(this.$set(this.saleClass,t,"van-slide-down-enter-active"),this.saleShow[t]=!this.saleShow[t]):(this.$set(this.saleShow,t,!0),this.$set(this.saleClass,t,"van-slide-down-enter-active"))},getHouseList:function(){var t=this,e=this.houseId,i={estate_id:e,is_group:0};this.$http.post("estates/getEstatesnewHouseList",i).then((function(e){var i=e.data,n=[],o=t.$api.localStore.localGet("u-tag");i.map((function(e){var i={};i.id=e.id,i.title=e.name,i.img=t.$api.imgDirtoUrl(e.img),i.tip=o&&o["house_purpose"]&&o["house_purpose"][e.house_purpose]?o["house_purpose"][e.house_purpose]:[],i.area=e.built_area,i.direction=o&&o["orientation"]&&o["orientation"][e.orientation]?o["orientation"][e.orientation]:[],i.price=e.price,i.price_ave=e.price_ave,n.push(i)})),t.navList.map((function(e,i){1==e.id&&t.$set(t.navList[i],"list",n)}))}))},showImg:function(e){var i=this,n={},o=[];"object"!=typeof e&&(e=[e]),e.map((function(t){var e=i.$api.imgDirtoUrl(t);o.push(e)})),n={urls:o,current:o[0]},t.previewImage(n)},getChartsList:function(){var t=this,e=this.houseId,i={id:e};this.$http.post("estates/getPriceHistory",i).then((function(e){var i=e.data;t.chartCreat("canvasColumn",i)}))},chartCreat:function(e,i){if(0!=i.length){var o=this,a=t.upx2px(686),r=t.upx2px(430),u={name:"",data:[]},c={categories:[],series:[]},h=0,l=0;i.map((function(t){c.categories.push(t.date),u.name=t.type,u.data.push(Number(t.value))})),c.series.push(u),h=Math.min.apply(Math,s(c.series[0].data)),l=Math.max.apply(Math,s(c.series[0].data)),h=h<1e4?0:(String(h)[0]-1)*Math.pow(10,String(h).length-1),l=(Number(String(l)[0])+1)*Math.pow(10,String(l).length-1);var p=t.createSelectorQuery();p.select("#"+e).fields({node:!0,size:!0}).exec((function(t){var i=t[0].node,s=i.getContext("2d");i.width=4*t[0].width,i.height=4*t[0].height,s.scale(4,4);var u={$this:o,canvasId:e,canvas2d:!0,context:s,type:"line",colors:["rgba(254, 130, 30, 1)"],fontSize:10,padding:[0,15,0,0],legend:{position:"top",float:"right",padding:0,margin:15,fontSize:12,fontColor:"#777"},dataLabel:!1,dataPointShape:!0,background:"#FFFFFF",categories:c.categories,series:c.series,animation:!1,xAxis:{labelCount:6,disableGrid:!0},yAxis:{data:[{format:function(t){return 0!=t?(t/1e4).toFixed(2)+"万":t},min:h,max:l,axisLine:!1}],gridType:"dash",gridColor:"#CCCCCC",dashLength:8,boundaryGap:"justify"},width:a,height:r,extra:{line:{type:"straight"}}};y=new n.default(u)}))}else this.haveCharts=!1},showLine:function(t){y.showToolTip(t,{format:function(t,e){return e+" "+t.name+":"+(t.data/1e4).toFixed(2)+"万"}})},getNews:function(){var t=this,e=this.houseId,i={id:e,dotype:"news"};this.$http.get("estates/getEstateArticle",i).then((function(e){var i=e.data;t.navList.map((function(e,n){4==e.id&&t.$set(t.navList[n],"list",i)}))}))},getEval:function(){var t=this,e=this.houseId,i={id:e,dotype:"assess"};this.$http.get("estates/getEstateArticle",i).then((function(e){var i=e.data;t.navList.map((function(e,n){5==e.id&&t.$set(t.navList[n],"list",i)}))}))},getTalk:function(){var t=this,e=this.houseId;console.log("id",e),console.log("houseId",this.houseId);var i={id:e,page:1,pageSize:2};this.$http.get("comment/propertyReviewsList",i).then((function(e){var i=e.data.list?e.data.list:[],n=[];i.map((function(e){var i={};i.id=e.id,i.head=t.$api.imgDirtoUrl(e.user_avatar),i.name=e.user_name,i.say=e.content,i.time=t.$api.timeFormat(e.create_time,"yyyy年mm月dd日"),i.img=e.img,n.push(i)})),t.navList.map((function(e,i){7==e.id&&t.$set(t.navList[i],"list",n)}))}))},getEstatesLike:function(){var t=this,e=this.city_no,i={city_no:e,subject_id:this.active_id,estate_id:this.houseId};this.$http.get("estates/getGuessList",i).then((function(e){var i=e.data;i.length>0&&(t.likeList=t.$api.createHouseList({list:i}))}))},careInfo:function(){var t=this;this.alertLogin(),this.$http.post("user/attentionListings",{id:this.houseId}).then((function(e){t.careState=1==t.careState?0:1,1==e.code?t.$toast(1==t.careState?"关注成功":"取消关注"):t.$toast(e.msg)}))},callByPhone:function(e){t.makePhoneCall({phoneNumber:e})}},onPageScroll:function(t){this.scrollTop=t.scrollTop}};e.default=w}).call(this,i("543d")["default"])},6765:function(t,e,i){"use strict";i.r(e);var n=i("7e57"),o=i("9248");for(var s in o)"default"!==s&&function(t){i.d(e,t,(function(){return o[t]}))}(s);i("0bed");var a,r=i("f0c5"),u=Object(r["a"])(o["default"],n["b"],n["c"],!1,null,"14c93a84",null,!1,n["a"],a);e["default"]=u.exports},"7e57":function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}));var n={uniNavBar:function(){return i.e("components/uni-nav-bar/uni-nav-bar").then(i.bind(null,"e898"))},uSwiper:function(){return i.e("uview-ui/components/u-swiper/u-swiper").then(i.bind(null,"e466"))},uButton:function(){return i.e("uview-ui/components/u-button/u-button").then(i.bind(null,"ad7e"))},uTag:function(){return i.e("uview-ui/components/u-tag/u-tag").then(i.bind(null,"7655"))},uIcon:function(){return i.e("uview-ui/components/u-icon/u-icon").then(i.bind(null,"6c52"))},uSticky:function(){return i.e("uview-ui/components/u-sticky/u-sticky").then(i.bind(null,"7109"))},uTabs:function(){return Promise.all([i.e("common/vendor"),i.e("uview-ui/components/u-tabs/u-tabs")]).then(i.bind(null,"f2ba"))},uIndexList:function(){return i.e("uview-ui/components/u-index-list/u-index-list").then(i.bind(null,"00a8"))},uIndexAnchor:function(){return i.e("uview-ui/components/u-index-anchor/u-index-anchor").then(i.bind(null,"ed6e"))},uModal:function(){return i.e("uview-ui/components/u-modal/u-modal").then(i.bind(null,"8cca"))},uPopup:function(){return i.e("uview-ui/components/u-popup/u-popup").then(i.bind(null,"0d7f"))}},o=function(){var t=this,e=t.$createElement,n=(t._self._c,t.pageShow&&t.infoList.name?t.__map(t.bannerList,(function(e,i){var n=t.__get_orig(e),o="VR"==e.name?t.$api.imgDirtoUrl(e.list[0]):null,s="VR"==e.name?t.$api.imgDirtoUrl("/houses/vr.png",1):null,a="VR"!=e.name&&"视频"==e.name?t.$api.imgDirtoUrl(e.img):null;return{$orig:n,g0:o,g1:s,g2:a}})):null),o=t.pageShow&&t.infoList.name?t.$api.imgDirtoUrl("/houses/share.png",1):null,s=t.pageShow&&t.infoList.name?t.infoList.use.join(","):null,a=t.pageShow&&t.infoList.name?t.navList.map((function(t){return t.name})):null,r=t.pageShow&&t.infoList.name?t.__map(t.navList,(function(e,i){var n=t.__get_orig(e),o=[1,3,4,5,6,9].includes(e.id),s=[1,3,4,5,7,8].includes(e.id),a=t.$api.imgDirtoUrl("/houses/sale.png",1),r=0!=e.id&&1==e.id&&e.list.length>0?t.__map(e.list,(function(e,i){var n=t.__get_orig(e),o=t.$api.imgDirtoUrl(e.img);return{$orig:n,g9:o}})):null,u=0!=e.id&&1!=e.id&&2!=e.id&&3!=e.id&&4!=e.id&&5!=e.id&&6!=e.id&&7!=e.id&&8==e.id&&e.list.num?t.$api.imgDirtoUrl(e.list.img):null;return{$orig:n,g6:o,g7:s,g8:a,l1:r,g10:u}})):null,u=t.$api.imgDirtoUrl("houses/phone.png"),c=t.pageShow&&t.infoList.name?t.__map(t.contactList,(function(e,i){var n=t.__get_orig(e),o=t.$api.imgDirtoUrl(e.head);return{$orig:n,g11:o}})):null,h=t.pageShow&&!t.infoList.name?i("221f"):null;t._isMounted||(t.e0=function(){t.changeState=!0},t.e1=function(e){t.contactShow=!0}),t.$mp.data=Object.assign({},{$root:{l0:n,g3:o,g4:s,g5:a,l2:r,g12:u,l3:c,m0:h}})},s=[]},9248:function(t,e,i){"use strict";i.r(e);var n=i("61aa"),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=o.a}},[["0775","common/runtime","common/vendor"]]]);