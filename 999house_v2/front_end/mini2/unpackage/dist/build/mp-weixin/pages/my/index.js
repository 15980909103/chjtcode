(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/my/index"],{"254a":function(e,t,n){"use strict";var i=n("3452"),o=n.n(i);o.a},3452:function(e,t,n){},"4a54":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return i}));var i={uIcon:function(){return n.e("uview-ui/components/u-icon/u-icon").then(n.bind(null,"6c52"))},uCellGroup:function(){return n.e("uview-ui/components/u-cell-group/u-cell-group").then(n.bind(null,"2bed"))},uCellItem:function(){return n.e("uview-ui/components/u-cell-item/u-cell-item").then(n.bind(null,"1df2"))},uPopup:function(){return n.e("uview-ui/components/u-popup/u-popup").then(n.bind(null,"0d7f"))},uField:function(){return n.e("uview-ui/components/u-field/u-field").then(n.bind(null,"6279"))},uUpload:function(){return Promise.all([n.e("common/vendor"),n.e("uview-ui/components/u-upload/u-upload")]).then(n.bind(null,"db06"))},uButton:function(){return n.e("uview-ui/components/u-button/u-button").then(n.bind(null,"ad7e"))},uModal:function(){return n.e("uview-ui/components/u-modal/u-modal").then(n.bind(null,"8cca"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.uInfo&&e.uInfo.headimgurl?null:e.$api.imgDirtoUrl("/my/touxiang.png")),i=e.$api.encryptPhone(e.uInfo.phone),o=e.$api.imgDirtoUrl("/my/history.png"),a=e.$api.imgDirtoUrl("/my/like.png"),u=e.$api.imgDirtoUrl("/my/calculator.png"),s=e.ad.img?e.$api.imgDirtoUrl(e.ad.img):null,r=e.uInfo&&e.uInfo.headimgurl?null:e.$api.imgDirtoUrl("/my/touxiang.png"),c=e.$api.encryptPhone(e.uInfo.phone),h=e.$api.imgDirtoUrl(e.serverCode),l=e.$api.imgDirtoUrl("/my/tencentIsux.jpg");e._isMounted||(e.e0=function(t){e.showKeFu=!0},e.e1=function(t){e.tencentIsux=!0}),e.$mp.data=Object.assign({},{$root:{g0:n,g1:i,g2:o,g3:a,g4:u,g5:s,g6:r,g7:c,g8:h,g9:l}})},a=[]},a704:function(e,t,n){"use strict";n.r(t);var i=n("4a54"),o=n("bca8");for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n("254a");var u,s=n("f0c5"),r=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],u);t["default"]=r.exports},abf4:function(e,t,n){"use strict";(function(e){function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function i(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){o(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=getApp(),u={data:function(){return{showKeFu:!1,tencentIsux:!1,uInfo:{headimgurl:"",nickname:"登录/注册",phone:""},ad:"",find_house_total:0,infoShow:!1,serverCode:"",changeShow:!1,changeShowType:1,uChange:{nickname:"",headimgurl:""},changePhoneText:"验证当前手机号",msgDisabled:!1,applyDisabled:!1,phoneNum:"",msg:"",timeOut:0,msgText:"获取验证码",upBtn:"验证"}},onLoad:function(){},onShow:function(){this.myInfo(1),this.serverCodeInfo(),this.getAdvs(),this.getEstatesList()},methods:{goAd:function(e){!this.$api.trim(e.href)&&e.info&&(e.href="houses/index?id="+e.info.estate_id+"&cover="+e.cover),e.href&&this.goPage(e.href)},getAdvs:function(){var e=this,t={falg:["h5_my_ad"],city_no:this.city_no};this.$http.post("/adv/getAdvByFlag",t).then((function(t){if(1==t.code){var n=t.data,i=[];for(var o in n.h5_my_ad)n.h5_my_ad[o]&&n.h5_my_ad[o].img&&i.push({img:n.h5_my_ad[o].img[0],href:n.h5_my_ad[o].href,info:n.h5_my_ad[o].info,cover:n.h5_my_ad[o].cover});i[0]&&(e.ad={img:i[0].img,href:i[0].href,info:i[0].info,cover:i[0].cover})}}))},goFindHouse:function(){this.find_house_total>0?this.goPage("/pages/index/find_result"):this.goPage("/pages/index/find_house")},changeInfoShow:function(e){console.log(this.isLogin()),this.isLogin()?this.infoShow=!0:this.goPage("authorize/index")},myInfo:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(a.globalData.userInfo&&a.globalData.userInfo.headimgurl&&0==t)return this.uInfo=a.globalData.userInfo;a.globalData.token&&this.$http.get("/user/getInfo").then((function(t){if(1==t.code){var n=t.data;n.headimgurl=e.imgDirtoUrl(n.headimgurl),e.uInfo=n,e.uChange.nickname=e.uInfo.nickname,a.globalData.userInfo=n,e.$api.getUserInfoByCache(n)}else e.$toast(t.msg)}))},serverCodeInfo:function(){var e=this;this.$http.get("/public/serverCode").then((function(t){1==t.code?e.serverCode=t.data:e.$toast(t.msg)}))},logOut:function(){var e=this,t=this.$http.getLocal("token");console.log(t),this.$http.post("/public/logout",{token:t}).then((function(t){localStorage.removeItem("token"),localStorage.removeItem("is_login"),localStorage.removeItem("info"),e.goPage("my/login.html")})).catch((function(t){e.$toast(t.msg)}))},changeInfo:function(e){1==e||2==e?(this.changeShowType=1,this.$set(this.uChange,"headimgurl",this.uInfo.headimgurl)):(this.changeShowType=2,this.upBtn="验证",this.changePhoneText="验证当前手机号",this.msgDisabled=!1,this.applyDisabled=!1,this.phoneNum="",this.msg=""),this.changeShow=!0},headChange:function(t){console.log(111);var n=this;for(var i in t)e.getFileSystemManager().readFile({filePath:t[i].file.path,encoding:"base64",success:function(e){var t="data:image/jpeg;base64,"+e.data;n.uChange.headimgurl=t}})},sureChange:function(){var t=this,n=this.uChange.headimgurl,o=this.uChange.nickname,a={},u=function(n){t.$http.get("/user/editUserInfo",i({},n)).then((function(i){var o=e.getStorageSync("user_info");for(var a in o||(o={}),n)t.$set(t.uInfo,a,n[a]),"nickname"==a?o.user_name=n[a]:o.user_avatar=n[a];t.$api.localStore.localSet("user_info",o),t.changeShow=!1,t.$toast("修改成功")})).catch((function(e){t.changeShow=!1,t.$toast(e.msg)}))};if(o.length>0||n){if(o.length>0&&(a.nickname=o),n)return a.headimgurl=n,void u(a);u(a)}},urlToBase64:function(e){return console.log(e),new Promise((function(t,n){var i=new Image;i.src=e.src,i.setAttribute("width",e.width),i.setAttribute("height",e.height),i.onload=function(){var n=document.createElement("canvas");n.width=2*e.width,n.height=2*e.height,n.getContext("2d").drawImage(i,0,0,2*e.width,2*e.height);var o=n.toDataURL("image/png",1);t(o)},i.onerror=function(){n(new Error("图片流异常"))}}))},getMsg:function(){this.$api.mobile(this.phoneNum)?this.sendCode():this.$toast("请输入正确手机号")},sendCode:function(){var e=this;this.$http.get("/public/sendMsg",{phone:this.phoneNum,sence:"sign_up",is_limit:this.changeShowType-1}).then((function(t){t.data;e.msgDisabled=!0,e.msgText=60,e.timeOut=setInterval((function(){1!=e.msgText?e.msgText-=1:(e.msgDisabled=!1,clearInterval(e.timeOut),e.msgText="获取验证码")}),1e3),e.$toast(t.data),console.log(t)})).catch((function(t){e.$toast(t.msg)}))},apply:function(){var e=this;if(this.phoneNum.length>0&&6==this.msg.length){var t=0;t="验证当前手机号"==this.changePhoneText?1:2,this.$http.get("/user/editUserPhone",{mobile:this.phoneNum,code:this.msg,type:t}).then((function(n){1==t?(clearInterval(e.timeOut),e.changePhoneText="绑定新手机号",e.upBtn="绑定",e.msgDisabled=!1,e.msgText="获取验证码",e.phoneNum="",e.msg=""):(e.$set(e.uInfo,"phone",e.phoneNum),e.changeShow=!1,e.$toast("绑定成功"))})).catch((function(t){e.$toast(t.msg)}))}else this.$toast("请正确填写信息")},getEstatesList:function(){var e=this,t=this.intLocalUChoose();0!=Object.keys(t).length?this.$http.get("/estates/getEstatesList",i(i({},t),{},{page:1})).then((function(t){t=t.data,e.find_house_total=t.total?t.total:0})).catch((function(t){e.$toast(t.msg)})):this.find_house_total=0},intLocalUChoose:function(){var e=this,t=this.$api.localStore.localGet("user_find_house"),n={};return t&&0!=Object.keys(t).length?(t.like&&t.like.map((function(e,t){n["tags["+t+"]"]=e})),t.area&&(n.built_area=t.area),t.site_id?"object"==typeof t.site_id?t.site_id.map((function(i,o){"area"==t.site_center.type?i&&(n["business_no["+o+"]"]=i):"subway"==t.site_center.type&&i&&(n["sites["+o+"]"]=i,n.city_no=e.city_no)})):(-1!=String(t.site_id).indexOf("p_")&&(t.site_id=t.site_id.replace("p_","")),"area"==t.site_center.type?n.area_no=t.site_id:"subway"==t.site_center.type&&(n.subway=t.site_id,n.city_no=this.city_no)):n.city_no=this.city_no,t.budget_str&&t.budget&&Number(t.budget)<1e3&&(n.price_type="total",n.price=t.budget_str),n.no_adv=1,n.page_size=20,n.purpose=t.aim,n.has_num=t.manyHouse,n):n}}};t.default=u}).call(this,n("543d")["default"])},bca8:function(e,t,n){"use strict";n.r(t);var i=n("abf4"),o=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=o.a},bf54:function(e,t,n){"use strict";(function(e){n("e878");i(n("66fd"));var t=i(n("a704"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["bf54","common/runtime","common/vendor"]]]);